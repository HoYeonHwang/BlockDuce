<template>
  <div class="container">
    <link
      rel="stylesheet"
      type="text/css"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap-extended.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/colors.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat&display=swap"
      rel="stylesheet"
    />

    <div class="grey-bg container-fluid">
      <section id="minimal-statistics">
        <div class="row">
          <div class="col-12 mt-3 mb-1">
            <h4 class="text-uppercase">account information</h4>
            <p>Statistics for your account</p>
          </div>
        </div>
        <div class="row">
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="align-self-center">
                      <i
                        class="icon-pencil primary font-large-2 float-left"
                      ></i>
                    </div>
                    <div class="media-body text-right">
                      <h3>278</h3>
                      <span>투표 횟수</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="align-self-center">
                      <i
                        class="icon-speech warning font-large-2 float-left"
                      ></i>
                    </div>
                    <div class="media-body text-right">
                      <h3>156</h3>
                      <span>투표한 양</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="align-self-center">
                      <i class="icon-graph success font-large-2 float-left"></i>
                    </div>
                    <div class="media-body text-right">
                      <h3>64.89 %</h3>
                      <span>DBC받은 횟수</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="align-self-center">
                      <i
                        class="icon-pointer danger font-large-2 float-left"
                      ></i>
                    </div>
                    <div class="media-body text-right">
                      <h3>423</h3>
                      <span>DBC받은 양</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="danger">278</h3>
                      <span>ETH받은 횟수</span>
                    </div>
                    <div class="align-self-center">
                      <i
                        class="icon-rocket danger font-large-2 float-right"
                      ></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="success">156</h3>
                      <span>ETH받은 양</span>
                    </div>
                    <div class="align-self-center">
                      <i class="icon-user success font-large-2 float-right"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="warning">64.89 %</h3>
                      <span>굿즈 구매 횟수</span>
                    </div>
                    <div class="align-self-center">
                      <i
                        class="icon-pie-chart warning font-large-2 float-right"
                      ></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="primary">423</h3>
                      <span>방문 수</span>
                    </div>
                    <div class="align-self-center">
                      <i
                        class="icon-support primary font-large-2 float-right"
                      ></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="row">
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="primary">278</h3>
                      <span>New Posts</span>
                    </div>
                    <div class="align-self-center">
                      <i
                        class="icon-book-open primary font-large-2 float-right"
                      ></i>
                    </div>
                  </div>
                  <div class="progress mt-1 mb-0" style="height: 7px;">
                    <div
                      class="progress-bar bg-primary"
                      role="progressbar"
                      style="width: 80%"
                      aria-valuenow="80"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="warning">156</h3>
                      <span>New Comments</span>
                    </div>
                    <div class="align-self-center">
                      <i
                        class="icon-bubbles warning font-large-2 float-right"
                      ></i>
                    </div>
                  </div>
                  <div class="progress mt-1 mb-0" style="height: 7px;">
                    <div
                      class="progress-bar bg-warning"
                      role="progressbar"
                      style="width: 35%"
                      aria-valuenow="35"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="success">64.89 %</h3>
                      <span>Bounce Rate</span>
                    </div>
                    <div class="align-self-center">
                      <i class="icon-cup success font-large-2 float-right"></i>
                    </div>
                  </div>
                  <div class="progress mt-1 mb-0" style="height: 7px;">
                    <div
                      class="progress-bar bg-success"
                      role="progressbar"
                      style="width: 60%"
                      aria-valuenow="60"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 col-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body">
                  <div class="media d-flex">
                    <div class="media-body text-left">
                      <h3 class="danger">423</h3>
                      <span>Total Visits</span>
                    </div>
                    <div class="align-self-center">
                      <i
                        class="icon-direction danger font-large-2 float-right"
                      ></i>
                    </div>
                  </div>
                  <div class="progress mt-1 mb-0" style="height: 7px;">
                    <div
                      class="progress-bar bg-danger"
                      role="progressbar"
                      style="width: 40%"
                      aria-valuenow="40"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div> -->
      </section>

      <section id="stats-subtitle">
        <div class="row">
          <div class="col-12 mt-3 mb-1">
            <h4 class="text-uppercase">Ethereum & Token</h4>
            <p>Statistics on ethereum and tokens</p>
          </div>
        </div>

        <div class="row">
          <div class="col-xl-6 col-md-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body cleartfix">
                  <div class="media align-items-stretch">
                    <div class="align-self-center">
                      <h1 class="mr-2">{{ DBCbalance }}</h1>
                    </div>
                    <div class="media-body">
                      <h4>Total DBC</h4>
                      <span>DroptheBitCoin</span>
                    </div>
                    <vs-button
                      transparent
                      :active="active == 1"
                      @click="[(active = 1), GetERCBalance()]"
                    >
                      refresh
                    </vs-button>
                    <div class="align-self-center">
                      <i class="icon-heart danger font-large-2"> </i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-6 col-md-12">
            <div class="card">
              <div class="card-content">
                <div class="card-body cleartfix">
                  <div class="media align-items-stretch">
                    <div class="align-self-center">
                      <h1 class="mr-2">{{ ETHbalance }}</h1>
                    </div>
                    <div class="media-body">
                      <h4>Total Ethereum</h4>
                      <span>Ethereum</span>
                    </div>
                    <vs-button
                      transparent
                      :active="active == 1"
                      @click="[(active = 1), GetBalance()]"
                    >
                      refresh
                    </vs-button>
                    <div class="align-self-center">
                      <i class="icon-wallet success font-large-2"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

//
<script>
let web3;
import * as Web3 from 'web3';
import DBCabi from './DBCabi.json';

export default {
  data() {
    return {
      active: 0,
      DBCbalance: 0,
      ETHbalance: 0,
    };
  },
  created() {
    console.log('ready!');
    if (typeof web3 !== 'undefined') {
      console.log('Web3 Detected! ' + web3.currentProvider.constructor.name);
      web3 = new Web3(web3.currentProvider);
    } else {
      console.log('No Web3 detected .. using HTTP provider');
      const projectId = 'b04025a46bb245b3bdb7c350a938dbe5';
      web3 = new Web3(
        new Web3.providers.HttpProvider(
          `https://ropsten.infura.io/v3/${projectId}`
        )
      );
    }
  },
  methods: {
    GetBalance: function() {
      var getbalance;
      var account = '0x9DFD19acAc0c523D19F9B50B4640a0dD74E092E6';
      web3.eth.getBalance(account, (error, wei) => {
        if (!error) {
          getbalance = web3.utils.fromWei(wei, 'ether');
          this.ETHbalance = getbalance + ' ETH';
        }
      });
      this.active = 0;
    },
    GetERCBalance: function() {
      var account = '0x9DFD19acAc0c523D19F9B50B4640a0dD74E092E6';
      var contractAddress = '0x9864bb32e02b1fae9eb875f7b169c5400b15efec';
      var TokenABI = DBCabi;
      var DBCcontract = new web3.eth.Contract(TokenABI, contractAddress);
      console.log(DBCcontract);
      let DBCtoken;
      DBCcontract.methods
        .balanceOf(account)
        .call()
        .then((result) => {
          DBCtoken = result / 100000;
          this.DBCbalance = DBCtoken + ' DBC';
          console.log(DBCtoken);
        });
      DBCcontract.methods
        .totalSupply()
        .call()
        .then((result) => {
          result = result / 100000;
          console.log(result);
        });
      this.active = 0;
    },
  },
};
</script>

<style scoped>
.grey-bg {
  background-color: #f5f7fa;
}
</style>
